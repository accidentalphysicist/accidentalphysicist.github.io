<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teaching Canvas</title>

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #1e1e1e;
      color: white;
    }

    #toolbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #2b2b2b;
      display: flex;
      gap: 10px;
      padding: 8px;
      z-index: 10;
    }

    button, input[type="color"] {
      padding: 5px 8px;
      cursor: pointer;
    }

    #canvas-container {
      margin-top: 60px;
      overflow-y: scroll;
      height: calc(100vh - 60px);
    }

    canvas {
      background: white;
      display: block;
      margin: auto;
    }

    .active {
      outline: 2px solid yellow;
    }
  </style>
</head>
<body>

<div id="toolbar">
  <button id="penBtn">Pen</button>
  <button id="eraserBtn">Eraser</button>
  <button id="lineBtn">Line</button>
  <button id="rectBtn">Rectangle</button>
  <button id="circleBtn">Circle</button>

  <input type="color" id="colorPicker" value="#000000">
  <input type="range" id="sizePicker" min="1" max="10" value="2">

  <button id="exportBtn">Export PDF</button>
</div>

<div id="canvas-container">
  <canvas id="canvas" width="1200" height="10000"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  let tool = "pen";
  let drawing = false;
  let startX, startY;

  ctx.lineCap = "round";

  const penBtn = document.getElementById("penBtn");
  const eraserBtn = document.getElementById("eraserBtn");
  const lineBtn = document.getElementById("lineBtn");
  const rectBtn = document.getElementById("rectBtn");
  const circleBtn = document.getElementById("circleBtn");

  function setTool(t, btn) {
    tool = t;
    document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  }

  penBtn.onclick = () => setTool("pen", penBtn);
  eraserBtn.onclick = () => setTool("eraser", eraserBtn);
  lineBtn.onclick = () => setTool("line", lineBtn);
  rectBtn.onclick = () => setTool("rect", rectBtn);
  circleBtn.onclick = () => setTool("circle", circleBtn);

  canvas.addEventListener("mousedown", e => {
    drawing = true;
    startX = e.offsetX;
    startY = e.offsetY;

    ctx.beginPath();
    ctx.moveTo(startX, startY);
  });

  canvas.addEventListener("mousemove", e => {
    if (!drawing) return;

    ctx.lineWidth = document.getElementById("sizePicker").value;

    if (tool === "pen") {
      ctx.globalCompositeOperation = "source-over";
      ctx.strokeStyle = document.getElementById("colorPicker").value;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    }

    if (tool === "eraser") {
      ctx.globalCompositeOperation = "destination-out";
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    }
  });

  canvas.addEventListener("mouseup", e => {
    if (!drawing) return;
    drawing = false;

    ctx.globalCompositeOperation = "source-over";

    const endX = e.offsetX;
    const endY = e.offsetY;

    if (tool === "line") {
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();
    }

    if (tool === "rect") {
      ctx.strokeRect(startX, startY, endX - startX, endY - startY);
    }

    if (tool === "circle") {
      const r = Math.hypot(endX - startX, endY - startY);
      ctx.beginPath();
      ctx.arc(startX, startY, r, 0, Math.PI * 2);
      ctx.stroke();
    }
  });

  document.getElementById("exportBtn").onclick = () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "px", "a4");

    const imgData = canvas.toDataURL("image/png");
    const pageHeight = pdf.internal.pageSize.height;
    const imgHeight = canvas.height * 595 / canvas.width;

    let y = 0;
    while (y < imgHeight) {
      pdf.addImage(imgData, "PNG", 0, -y, 595, imgHeight);
      y += pageHeight;
      if (y < imgHeight) pdf.addPage();
    }

    pdf.save("class-notes.pdf");
  };
</script>

</body>
</html>
